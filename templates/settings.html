{% extends "base.html" %}

{% block title %}{{ t('settings') if t else 'Tetapan Akaun' }}{% endblock %}

{% block extra_styles %}
<style>
    .settings-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 32px 24px;
    }

    .page-header {
        background: var(--bg-white);
        padding: 28px 32px;
        border-radius: var(--radius-lg);
        margin-bottom: 28px;
        border: 1px solid var(--border);
    }

    .page-header h1 {
        color: var(--text-dark);
        font-size: 28px;
        margin-bottom: 6px;
    }

    .page-header p {
        color: var(--text-gray);
        font-size: 15px;
    }

    .settings-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 24px;
        flex-wrap: wrap;
    }

    .settings-tab {
        padding: 12px 20px;
        background: var(--bg-white);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        font-size: 14px;
        font-weight: 600;
        color: var(--text-gray);
        cursor: pointer;
        transition: all 0.2s;
    }

    .settings-tab:hover {
        background: var(--bg-light);
    }

    .settings-tab.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .settings-section {
        background: var(--bg-white);
        padding: 28px 32px;
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
        margin-bottom: 24px;
        display: none;
    }

    .settings-section.active {
        display: block;
    }

    .section-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 8px;
    }

    .section-description {
        color: var(--text-gray);
        font-size: 14px;
        margin-bottom: 24px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }

    .form-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 8px;
    }

    .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        font-size: 14px;
        color: var(--text-dark);
        transition: all 0.2s;
        background: var(--bg-white);
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(0, 200, 83, 0.1);
    }

    .form-input:disabled {
        background: var(--bg-light);
        color: var(--text-gray);
        cursor: not-allowed;
    }

    .form-select {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        font-size: 14px;
        color: var(--text-dark);
        background: var(--bg-white);
        cursor: pointer;
    }

    .form-select:focus {
        outline: none;
        border-color: var(--primary);
    }

    .form-hint {
        font-size: 12px;
        color: var(--text-light);
        margin-top: 6px;
    }

    .btn {
        padding: 12px 24px;
        border-radius: var(--radius-md);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        border: none;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary {
        background: var(--primary);
        color: white;
    }

    .btn-primary:hover {
        background: var(--primary-dark);
    }

    .btn-secondary {
        background: var(--bg-light);
        color: var(--text-dark);
        border: 1px solid var(--border);
    }

    .btn-secondary:hover {
        background: var(--border);
    }

    .btn-danger {
        background: var(--error);
        color: white;
    }

    .btn-danger:hover {
        background: #d63030;
    }

    .form-actions {
        display: flex;
        gap: 12px;
        margin-top: 24px;
        padding-top: 24px;
        border-top: 1px solid var(--border);
    }

    .alert {
        padding: 14px 18px;
        border-radius: var(--radius-md);
        margin-bottom: 20px;
        font-size: 14px;
    }

    .alert-success {
        background: #ecfdf5;
        color: #065f46;
        border: 1px solid #a7f3d0;
    }

    .alert-error {
        background: #fef2f2;
        color: #991b1b;
        border: 1px solid #fecaca;
    }

    .alert-warning {
        background: #fffbeb;
        color: #92400e;
        border: 1px solid #fde68a;
    }

    .info-card {
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: var(--radius-md);
        padding: 16px;
        margin-bottom: 20px;
    }

    .info-card p {
        color: #0c4a6e;
        font-size: 14px;
        margin: 0;
    }

    .masked-value {
        font-family: monospace;
        letter-spacing: 1px;
    }

    .password-requirements {
        font-size: 12px;
        color: var(--text-light);
        margin-top: 8px;
    }

    .password-requirements li {
        margin-bottom: 4px;
    }

    .divider {
        height: 1px;
        background: var(--border);
        margin: 24px 0;
    }

    @media (max-width: 768px) {
        .settings-container {
            padding: 16px;
        }

        .page-header, .settings-section {
            padding: 20px;
        }

        .form-row {
            grid-template-columns: 1fr;
        }

        .form-actions {
            flex-direction: column;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="page-header">
        <h1>Tetapan Akaun</h1>
        <p>Urus maklumat peribadi, keselamatan dan butiran pembayaran anda</p>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="settings-tabs">
        <button class="settings-tab active" data-tab="profile">Maklumat Peribadi</button>
        <button class="settings-tab" data-tab="verification">Pengesahan Identiti</button>
        <button class="settings-tab" data-tab="security">Keselamatan</button>
        <button class="settings-tab" data-tab="payment">Maklumat Pembayaran</button>
    </div>

    <!-- Profile Settings Section -->
    <div class="settings-section active" id="profile-section">
        <h2 class="section-title">Maklumat Peribadi</h2>
        <p class="section-description">Kemaskini maklumat profil anda. Maklumat ini akan dipaparkan kepada klien dan pekerja lain.</p>

        <form action="/settings/profile" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Nama Penuh</label>
                    <input type="text" name="full_name" class="form-input" value="{{ user.full_name or '' }}" placeholder="Masukkan nama penuh">
                </div>
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" value="{{ user.username }}" disabled>
                    <p class="form-hint">Username tidak boleh diubah</p>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">No. Telefon</label>
                    <input type="tel" name="phone" class="form-input" value="{{ user.phone or '' }}" placeholder="Contoh: 0123456789">
                </div>
                <div class="form-group">
                    <label class="form-label">Lokasi</label>
                    <select name="location" class="form-select">
                        <option value="">Pilih lokasi</option>
                        <!-- Kuala Lumpur -->
                        <optgroup label="Kuala Lumpur">
                            <option value="Kuala Lumpur" {{ 'selected' if user.location == 'Kuala Lumpur' else '' }}>Kuala Lumpur</option>
                            <option value="Cheras, KL" {{ 'selected' if user.location == 'Cheras, KL' else '' }}>Cheras</option>
                            <option value="Kepong, KL" {{ 'selected' if user.location == 'Kepong, KL' else '' }}>Kepong</option>
                            <option value="Bangsar, KL" {{ 'selected' if user.location == 'Bangsar, KL' else '' }}>Bangsar</option>
                        </optgroup>
                        <!-- Johor -->
                        <optgroup label="Johor">
                            <option value="Johor Bahru, Johor" {{ 'selected' if user.location == 'Johor Bahru, Johor' else '' }}>Johor Bahru</option>
                            <option value="Skudai, Johor" {{ 'selected' if user.location == 'Skudai, Johor' else '' }}>Skudai</option>
                            <option value="Kulai, Johor" {{ 'selected' if user.location == 'Kulai, Johor' else '' }}>Kulai</option>
                            <option value="Kluang, Johor" {{ 'selected' if user.location == 'Kluang, Johor' else '' }}>Kluang</option>
                            <option value="Muar, Johor" {{ 'selected' if user.location == 'Muar, Johor' else '' }}>Muar</option>
                            <option value="Batu Pahat, Johor" {{ 'selected' if user.location == 'Batu Pahat, Johor' else '' }}>Batu Pahat</option>
                            <option value="Segamat, Johor" {{ 'selected' if user.location == 'Segamat, Johor' else '' }}>Segamat</option>
                        </optgroup>
                        <!-- Penang -->
                        <optgroup label="Penang">
                            <option value="George Town, Penang" {{ 'selected' if user.location == 'George Town, Penang' else '' }}>George Town</option>
                            <option value="Butterworth, Penang" {{ 'selected' if user.location == 'Butterworth, Penang' else '' }}>Butterworth</option>
                            <option value="Bayan Lepas, Penang" {{ 'selected' if user.location == 'Bayan Lepas, Penang' else '' }}>Bayan Lepas</option>
                            <option value="Seberang Jaya, Penang" {{ 'selected' if user.location == 'Seberang Jaya, Penang' else '' }}>Seberang Jaya</option>
                            <option value="Sungai Petani, Penang" {{ 'selected' if user.location == 'Sungai Petani, Penang' else '' }}>Sungai Petani</option>
                        </optgroup>
                        <!-- Selangor -->
                        <optgroup label="Selangor">
                            <option value="Petaling Jaya, Selangor" {{ 'selected' if user.location == 'Petaling Jaya, Selangor' else '' }}>Petaling Jaya</option>
                            <option value="Shah Alam, Selangor" {{ 'selected' if user.location == 'Shah Alam, Selangor' else '' }}>Shah Alam</option>
                            <option value="Subang Jaya, Selangor" {{ 'selected' if user.location == 'Subang Jaya, Selangor' else '' }}>Subang Jaya</option>
                            <option value="Klang, Selangor" {{ 'selected' if user.location == 'Klang, Selangor' else '' }}>Klang</option>
                            <option value="Ampang, Selangor" {{ 'selected' if user.location == 'Ampang, Selangor' else '' }}>Ampang</option>
                            <option value="Kajang, Selangor" {{ 'selected' if user.location == 'Kajang, Selangor' else '' }}>Kajang</option>
                            <option value="Rawang, Selangor" {{ 'selected' if user.location == 'Rawang, Selangor' else '' }}>Rawang</option>
                            <option value="Sepang, Selangor" {{ 'selected' if user.location == 'Sepang, Selangor' else '' }}>Sepang</option>
                            <option value="Serdang, Selangor" {{ 'selected' if user.location == 'Serdang, Selangor' else '' }}>Serdang</option>
                        </optgroup>
                        <!-- Perak -->
                        <optgroup label="Perak">
                            <option value="Ipoh, Perak" {{ 'selected' if user.location == 'Ipoh, Perak' else '' }}>Ipoh</option>
                            <option value="Taiping, Perak" {{ 'selected' if user.location == 'Taiping, Perak' else '' }}>Taiping</option>
                            <option value="Teluk Intan, Perak" {{ 'selected' if user.location == 'Teluk Intan, Perak' else '' }}>Teluk Intan</option>
                            <option value="Kuala Lumpur, Perak" {{ 'selected' if user.location == 'Kuala Lumpur, Perak' else '' }}>Kuala Lumpur (Perak)</option>
                        </optgroup>
                        <!-- Kedah -->
                        <optgroup label="Kedah">
                            <option value="Alor Setar, Kedah" {{ 'selected' if user.location == 'Alor Setar, Kedah' else '' }}>Alor Setar</option>
                            <option value="Sungai Petani, Kedah" {{ 'selected' if user.location == 'Sungai Petani, Kedah' else '' }}>Sungai Petani</option>
                            <option value="Kulim, Kedah" {{ 'selected' if user.location == 'Kulim, Kedah' else '' }}>Kulim</option>
                        </optgroup>
                        <!-- Kelantan -->
                        <optgroup label="Kelantan">
                            <option value="Kota Bharu, Kelantan" {{ 'selected' if user.location == 'Kota Bharu, Kelantan' else '' }}>Kota Bharu</option>
                            <option value="Kuantan, Kelantan" {{ 'selected' if user.location == 'Kuantan, Kelantan' else '' }}>Kuantan</option>
                        </optgroup>
                        <!-- Terengganu -->
                        <optgroup label="Terengganu">
                            <option value="Kuala Terengganu, Terengganu" {{ 'selected' if user.location == 'Kuala Terengganu, Terengganu' else '' }}>Kuala Terengganu</option>
                            <option value="Kuantan, Terengganu" {{ 'selected' if user.location == 'Kuantan, Terengganu' else '' }}>Kuantan</option>
                        </optgroup>
                        <!-- Pahang -->
                        <optgroup label="Pahang">
                            <option value="Kuantan, Pahang" {{ 'selected' if user.location == 'Kuantan, Pahang' else '' }}>Kuantan</option>
                            <option value="Temerloh, Pahang" {{ 'selected' if user.location == 'Temerloh, Pahang' else '' }}>Temerloh</option>
                            <option value="Pekan, Pahang" {{ 'selected' if user.location == 'Pekan, Pahang' else '' }}>Pekan</option>
                        </optgroup>
                        <!-- Melaka -->
                        <optgroup label="Melaka">
                            <option value="Melaka City, Melaka" {{ 'selected' if user.location == 'Melaka City, Melaka' else '' }}>Melaka City</option>
                            <option value="Alor Gajah, Melaka" {{ 'selected' if user.location == 'Alor Gajah, Melaka' else '' }}>Alor Gajah</option>
                        </optgroup>
                        <!-- Negeri Sembilan -->
                        <optgroup label="Negeri Sembilan">
                            <option value="Seremban, Negeri Sembilan" {{ 'selected' if user.location == 'Seremban, Negeri Sembilan' else '' }}>Seremban</option>
                            <option value="Nilai, Negeri Sembilan" {{ 'selected' if user.location == 'Nilai, Negeri Sembilan' else '' }}>Nilai</option>
                        </optgroup>
                        <!-- Sabah -->
                        <optgroup label="Sabah">
                            <option value="Kota Kinabalu, Sabah" {{ 'selected' if user.location == 'Kota Kinabalu, Sabah' else '' }}>Kota Kinabalu</option>
                            <option value="Sandakan, Sabah" {{ 'selected' if user.location == 'Sandakan, Sabah' else '' }}>Sandakan</option>
                            <option value="Tawau, Sabah" {{ 'selected' if user.location == 'Tawau, Sabah' else '' }}>Tawau</option>
                            <option value="Lahad Datu, Sabah" {{ 'selected' if user.location == 'Lahad Datu, Sabah' else '' }}>Lahad Datu</option>
                        </optgroup>
                        <!-- Sarawak -->
                        <optgroup label="Sarawak">
                            <option value="Kuching, Sarawak" {{ 'selected' if user.location == 'Kuching, Sarawak' else '' }}>Kuching</option>
                            <option value="Miri, Sarawak" {{ 'selected' if user.location == 'Miri, Sarawak' else '' }}>Miri</option>
                            <option value="Sibu, Sarawak" {{ 'selected' if user.location == 'Sibu, Sarawak' else '' }}>Sibu</option>
                            <option value="Bintulu, Sarawak" {{ 'selected' if user.location == 'Bintulu, Sarawak' else '' }}>Bintulu</option>
                        </optgroup>
                        <!-- Perlis -->
                        <optgroup label="Perlis">
                            <option value="Kangar, Perlis" {{ 'selected' if user.location == 'Kangar, Perlis' else '' }}>Kangar</option>
                        </optgroup>
                        <!-- Putrajaya & Labuan -->
                        <optgroup label="Federal Territories">
                            <option value="Putrajaya, Putrajaya" {{ 'selected' if user.location == 'Putrajaya, Putrajaya' else '' }}>Putrajaya</option>
                            <option value="Labuan, Labuan" {{ 'selected' if user.location == 'Labuan, Labuan' else '' }}>Labuan</option>
                        </optgroup>
                        <option value="Lain-lain" {{ 'selected' if user.location == 'Lain-lain' else '' }}>Lain-lain</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Jenis Pengguna</label>
                    <select name="user_type" class="form-select">
                        <option value="freelancer" {{ 'selected' if user.user_type == 'freelancer' else '' }}>Freelancer (Cari Kerja)</option>
                        <option value="client" {{ 'selected' if user.user_type == 'client' else '' }}>Client (Post Kerja)</option>
                        <option value="both" {{ 'selected' if user.user_type == 'both' else '' }}>Kedua-duanya</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Bahasa Pilihan</label>
                    <select name="language" class="form-select">
                        <option value="ms" {{ 'selected' if user.language == 'ms' else '' }}>Bahasa Melayu</option>
                        <option value="en" {{ 'selected' if user.language == 'en' else '' }}>English</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Bio / Tentang Saya</label>
                <textarea name="bio" class="form-input" rows="4" placeholder="Ceritakan tentang diri anda, pengalaman dan kemahiran...">{{ user.bio or '' }}</textarea>
            </div>

            <div class="form-group">
                <label class="form-label">No. Kad Pengenalan (IC)</label>
                <input type="text" name="ic_number" class="form-input" value="{{ user.ic_number or '' }}" placeholder="Contoh: 901234567890" maxlength="12" pattern="[0-9]{12}">
                <p class="form-hint">12 digit tanpa sengkang (-). Diperlukan untuk pengesahan identiti.</p>
            </div>

            <div class="form-group">
                <label class="form-label">No. Ahli SOCSO</label>
                <input type="text" name="socso_membership_number" class="form-input" value="{{ user.socso_membership_number or '' }}" placeholder="Contoh: 1234567890" maxlength="20">
                <p class="form-hint">Nombor keahlian SOCSO anda (jika ada).</p>
            </div>

            <div class="form-group" style="padding: 16px; background: var(--bg-light); border-radius: var(--radius-md); border-left: 4px solid var(--primary);">
                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; margin: 0;">
                    <input type="checkbox" name="socso_consent" value="1" {% if user.socso_consent %}checked{% endif %} style="width: 18px; height: 18px; cursor: pointer;">
                    <span>
                        <strong>Saya Bersetuju dengan Potongan SOCSO</strong>
                        <p style="font-size: 13px; color: var(--text-gray); margin: 4px 0 0 0; font-weight: normal;">
                            Saya memahami dan bersetuju untuk memotong sumbangan SOCSO sebanyak 1.25% daripada pendapatan saya untuk perlindungan sosial.
                        </p>
                    </span>
                </label>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
            </div>
        </form>
    </div>

    <!-- Verification Settings Section -->
    <div class="settings-section" id="verification-section">
        <h2 class="section-title">Pengesahan Identiti</h2>
        <p class="section-description">Muat naik salinan IC/MyKad atau pasport anda untuk pengesahan identiti. Pengguna yang disahkan mendapat kepercayaan lebih tinggi.</p>

        {% if verification %}
        <div class="{% if verification.status == 'approved' %}alert alert-success{% elif verification.status == 'rejected' %}alert alert-error{% else %}alert alert-warning{% endif %}">
            <strong>Status Pengesahan:</strong>
            {% if verification.status == 'approved' %}
                ✅ Disahkan pada {{ verification.verified_at.strftime('%d %b %Y') if verification.verified_at else '-' }}
            {% elif verification.status == 'rejected' %}
                ❌ Ditolak - {{ verification.rejection_reason or 'Tiada sebab diberikan' }}
            {% else %}
                ⏳ Sedang Diproses
            {% endif %}
        </div>
        
        {% if verification.ic_front_image or verification.ic_back_image %}
        <div style="margin-bottom: 24px;">
            <h3 style="font-size: 16px; margin-bottom: 12px; color: var(--text-dark);">Dokumen Dimuat Naik</h3>
            <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                {% if verification.ic_front_image %}
                <div style="text-align: center;">
                    <img src="/uploads/{{ verification.ic_front_image }}" alt="IC Front" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid var(--border);">
                    <p style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">IC Depan</p>
                </div>
                {% endif %}
                {% if verification.ic_back_image %}
                <div style="text-align: center;">
                    <img src="/uploads/{{ verification.ic_back_image }}" alt="IC Back" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 1px solid var(--border);">
                    <p style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">IC Belakang</p>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% endif %}

        {% if not verification or verification.status in ['rejected'] %}
        <div class="info-card">
            <p><strong>Keperluan:</strong> Muat naik gambar IC/MyKad atau pasport yang jelas (depan dan belakang). Pastikan semua maklumat boleh dibaca dengan jelas.</p>
        </div>

        <form action="/settings/verification" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">IC/Pasport (Depan) *</label>
                    <input type="file" name="ic_front" class="form-input" accept="image/*" required style="padding: 10px;">
                    <p class="form-hint">Format: PNG, JPG, JPEG (Max 5MB)</p>
                </div>
                <div class="form-group">
                    <label class="form-label">IC/Pasport (Belakang) *</label>
                    <input type="file" name="ic_back" class="form-input" accept="image/*" required style="padding: 10px;">
                    <p class="form-hint">Format: PNG, JPG, JPEG (Max 5MB)</p>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Hantar untuk Pengesahan</button>
            </div>
        </form>
        {% elif verification.status == 'pending' %}
        <div class="info-card">
            <p>Dokumen anda sedang disemak oleh pasukan kami. Proses ini biasanya mengambil masa 1-3 hari bekerja.</p>
        </div>
        
        <form action="/settings/verification" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <h3 style="font-size: 16px; margin-bottom: 16px; color: var(--text-dark);">Muat Naik Semula (Jika Diperlukan)</h3>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">IC/Pasport (Depan) *</label>
                    <input type="file" name="ic_front" class="form-input" accept="image/*" required style="padding: 10px;">
                </div>
                <div class="form-group">
                    <label class="form-label">IC/Pasport (Belakang) *</label>
                    <input type="file" name="ic_back" class="form-input" accept="image/*" required style="padding: 10px;">
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-secondary">Muat Naik Semula</button>
            </div>
        </form>
        {% endif %}
    </div>

    <!-- Security Settings Section -->
    <div class="settings-section" id="security-section">
        <h2 class="section-title">Keselamatan Akaun</h2>
        <p class="section-description">Urus kata laluan dan emel akaun anda</p>

        <!-- Change Email -->
        <div class="info-card">
            <p><strong>Emel Semasa:</strong> {{ user.email }}</p>
        </div>

        <form action="/settings/email" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <h3 style="font-size: 16px; margin-bottom: 16px; color: var(--text-dark);">Tukar Emel</h3>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Emel Baru</label>
                    <input type="email" name="new_email" class="form-input" placeholder="Masukkan emel baru" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Kata Laluan Semasa</label>
                    <input type="password" name="current_password" class="form-input" placeholder="Masukkan kata laluan" required>
                    <p class="form-hint">Diperlukan untuk pengesahan</p>
                </div>
            </div>
            <div class="form-actions" style="border-top: none; padding-top: 0;">
                <button type="submit" class="btn btn-primary">Tukar Emel</button>
            </div>
        </form>

        <div class="divider"></div>

        <!-- Change Password -->
        <form action="/settings/password" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <h3 style="font-size: 16px; margin-bottom: 16px; color: var(--text-dark);">Tukar Kata Laluan</h3>
            <div class="form-group">
                <label class="form-label">Kata Laluan Semasa</label>
                <input type="password" name="current_password" class="form-input" placeholder="Masukkan kata laluan semasa" required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Kata Laluan Baru</label>
                    <input type="password" name="new_password" class="form-input" placeholder="Masukkan kata laluan baru" required minlength="8">
                </div>
                <div class="form-group">
                    <label class="form-label">Sahkan Kata Laluan Baru</label>
                    <input type="password" name="confirm_password" class="form-input" placeholder="Masukkan semula kata laluan baru" required>
                </div>
            </div>
            <ul class="password-requirements">
                <li>Minimum 8 aksara</li>
                <li>Disyorkan: gabungan huruf besar, huruf kecil, nombor dan simbol</li>
            </ul>
            <div class="form-actions" style="border-top: none; padding-top: 16px;">
                <button type="submit" class="btn btn-primary">Tukar Kata Laluan</button>
            </div>
        </form>
    </div>

    <!-- Payment Settings Section -->
    <div class="settings-section" id="payment-section">
        <h2 class="section-title">Maklumat Pembayaran</h2>
        <p class="section-description">Tambah maklumat bank anda untuk menerima bayaran daripada klien atau membuat pembayaran kepada pekerja.</p>

        <div class="info-card">
            <p><strong>Penting:</strong> Pastikan nama pemegang akaun sama dengan nama di IC anda untuk mengelakkan masalah pembayaran.</p>
        </div>

        <form action="/settings/bank" method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="form-group">
                <label class="form-label">Nama Bank</label>
                <select name="bank_name" class="form-select">
                    <option value="">Pilih bank</option>
                    {% for bank in ['Maybank', 'CIMB Bank', 'Public Bank', 'RHB Bank', 'Hong Leong Bank', 'AmBank', 'Bank Islam', 'Bank Rakyat', 'Bank Simpanan Nasional (BSN)', 'Affin Bank', 'Alliance Bank', 'Standard Chartered', 'HSBC', 'OCBC Bank', 'UOB Malaysia', 'Agrobank', 'Bank Muamalat', 'MBSB Bank'] %}
                        <option value="{{ bank }}" {{ 'selected' if user.bank_name == bank else '' }}>{{ bank }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Nombor Akaun</label>
                    <input type="text" name="bank_account_number" class="form-input" value="{{ user.bank_account_number or '' }}" placeholder="Masukkan nombor akaun bank" pattern="[0-9]{8,20}">
                    <p class="form-hint">8-20 digit nombor sahaja</p>
                </div>
                <div class="form-group">
                    <label class="form-label">Nama Pemegang Akaun</label>
                    <input type="text" name="bank_account_holder" class="form-input" value="{{ user.bank_account_holder or '' }}" placeholder="Nama seperti di buku akaun bank">
                    <p class="form-hint">Nama mesti sama dengan nama di IC</p>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Simpan Maklumat Bank</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.settings-tab');
    const sections = document.querySelectorAll('.settings-section');

    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetTab = this.dataset.tab;

            tabs.forEach(t => t.classList.remove('active'));
            sections.forEach(s => s.classList.remove('active'));

            this.classList.add('active');
            document.getElementById(targetTab + '-section').classList.add('active');
        });
    });
});
</script>
{% endblock %}
