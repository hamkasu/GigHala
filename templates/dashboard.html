{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block extra_styles %}
<style>
    .welcome-header {
        background: var(--bg-white);
        padding: 28px 32px;
        border-radius: var(--radius-lg);
        margin-bottom: 28px;
        border: 1px solid var(--border);
    }

    .welcome-header h1 {
        color: var(--text-dark);
        font-size: 28px;
        margin-bottom: 6px;
    }

    .welcome-header p {
        color: var(--text-gray);
        font-size: 15px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 28px;
    }

    .stat-card {
        background: var(--bg-white);
        padding: 24px;
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
    }

    .stat-card.primary::before { background: var(--primary); }
    .stat-card.green::before { background: #10b981; }
    .stat-card.blue::before { background: #3b82f6; }
    .stat-card.orange::before { background: #f59e0b; }

    .stat-label {
        font-size: 13px;
        color: var(--text-gray);
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: 4px;
    }

    .stat-description {
        font-size: 13px;
        color: var(--text-light);
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 24px;
    }

    .section {
        background: var(--bg-white);
        padding: 24px;
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 14px;
        border-bottom: 1px solid var(--border);
    }

    .section-title {
        font-size: 17px;
        font-weight: 700;
        color: var(--text-dark);
    }

    .view-all {
        color: var(--primary);
        text-decoration: none;
        font-size: 14px;
        font-weight: 600;
    }

    .view-all:hover {
        text-decoration: underline;
    }

    .gig-item, .transaction-item {
        padding: 14px;
        border-radius: var(--radius-md);
        margin-bottom: 12px;
        background: var(--bg-light);
        transition: all 0.2s;
    }

    .gig-item:hover, .transaction-item:hover {
        background: #e9ecef;
    }

    .gig-item:last-child, .transaction-item:last-child {
        margin-bottom: 0;
    }

    .gig-title {
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 8px;
        font-size: 15px;
    }

    .gig-meta {
        display: flex;
        gap: 14px;
        font-size: 13px;
        color: var(--text-gray);
        flex-wrap: wrap;
    }

    .badge {
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        display: inline-block;
    }

    .badge.open { background: #dbeafe; color: #1e40af; }
    .badge.in_progress { background: #fef3c7; color: #92400e; }
    .badge.completed { background: #d1fae5; color: #065f46; }
    .badge.pending { background: #fecaca; color: #991b1b; }
    .badge.accepted { background: #d1fae5; color: #065f46; }
    .badge.rejected { background: #fee2e2; color: #991b1b; }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-gray);
    }

    .empty-state-icon {
        font-size: 40px;
        margin-bottom: 12px;
    }

    .quick-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 24px;
    }

    @media (max-width: 768px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="welcome-header">
    <h1>Welcome back, {{ user.full_name or user.username }}!</h1>
    <p>Here's what's happening with your account today</p>
</div>

<div class="stats-grid">
    <div class="stat-card primary">
        <div class="stat-label">Wallet Balance</div>
        <div class="stat-value">MYR {{ "%.2f"|format(wallet.balance) }}</div>
        <div class="stat-description">Available to withdraw</div>
    </div>

    {% if user.user_type in ['freelancer', 'both'] %}
    <div class="stat-card green">
        <div class="stat-label">Completed Gigs</div>
        <div class="stat-value">{{ total_gigs_completed }}</div>
        <div class="stat-description">Successfully finished</div>
    </div>

    <div class="stat-card blue">
        <div class="stat-label">Active Applications</div>
        <div class="stat-value">{{ total_applications }}</div>
        <div class="stat-description">Submitted proposals</div>
    </div>
    {% endif %}

    {% if user.user_type in ['client', 'both'] %}
    <div class="stat-card orange">
        <div class="stat-label">Posted Gigs</div>
        <div class="stat-value">{{ total_gigs_posted }}</div>
        <div class="stat-description">Total gigs created</div>
    </div>
    {% endif %}

    <div class="stat-card green">
        <div class="stat-label">Total Earned</div>
        <div class="stat-value">MYR {{ "%.2f"|format(wallet.total_earned) }}</div>
        <div class="stat-description">All-time earnings</div>
    </div>
</div>

<div class="dashboard-grid">
    {% if user.user_type in ['freelancer', 'both'] %}
    <div class="section">
        <div class="section-header">
            <h2 class="section-title">Active Gigs</h2>
            <a href="/gigs" class="view-all">View All</a>
        </div>

        {% if active_gigs %}
            {% for gig in active_gigs %}
            <div class="gig-item">
                <div class="gig-title">{{ gig.title }}</div>
                <div class="gig-meta">
                    <span><span class="badge {{ gig.status }}">{{ gig.status }}</span></span>
                    <span>MYR {{ gig.budget_min }}-{{ gig.budget_max }}</span>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üìã</div>
                <p>No active gigs</p>
                <a href="/gigs" class="btn btn-primary" style="margin-top: 12px;">Browse Gigs</a>
            </div>
        {% endif %}
    </div>

    <div class="section">
        <div class="section-header">
            <h2 class="section-title">Recent Applications</h2>
            <a href="/gigs" class="view-all">View All</a>
        </div>

        {% if applications %}
            {% for app in applications %}
            <div class="gig-item">
                <div class="gig-title">Application #{{ app.id }}</div>
                <div class="gig-meta">
                    <span><span class="badge {{ app.status }}">{{ app.status }}</span></span>
                    <span>MYR {{ app.proposed_price }}</span>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">‚úâÔ∏è</div>
                <p>No applications yet</p>
            </div>
        {% endif %}
    </div>
    {% endif %}

    {% if user.user_type in ['client', 'both'] %}
    <div class="section">
        <div class="section-header">
            <h2 class="section-title">Your Posted Gigs</h2>
            <a href="/gigs" class="view-all">View All</a>
        </div>

        {% if posted_gigs %}
            {% for gig in posted_gigs %}
            <div class="gig-item">
                <div class="gig-title">{{ gig.title }}</div>
                <div class="gig-meta">
                    <span><span class="badge {{ gig.status }}">{{ gig.status }}</span></span>
                    <span>MYR {{ gig.budget_min }}-{{ gig.budget_max }}</span>
                    <span>{{ gig.views }} views</span>
                    <span>{{ gig.applications }} applications</span>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üì¢</div>
                <p>No posted gigs</p>
                <a href="/post-gig" class="btn btn-primary" style="margin-top: 12px;">Post a Gig</a>
            </div>
        {% endif %}
    </div>
    {% endif %}

    <div class="section">
        <div class="section-header">
            <h2 class="section-title">Recent Transactions</h2>
            <a href="/billing" class="view-all">View All</a>
        </div>

        {% if recent_transactions %}
            {% for txn in recent_transactions %}
            <div class="transaction-item">
                <div class="gig-title">
                    {% if txn.client_id == user.id %}
                    Payment Sent
                    {% else %}
                    Payment Received
                    {% endif %}
                </div>
                <div class="gig-meta">
                    <span>MYR {{ "%.2f"|format(txn.amount) }}</span>
                    <span><span class="badge {{ txn.status }}">{{ txn.status }}</span></span>
                    <span>{{ txn.transaction_date.strftime('%d %b %Y') }}</span>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üí∏</div>
                <p>No transactions yet</p>
            </div>
        {% endif %}
    </div>
</div>

<div class="section" style="margin-top: 24px;">
    <h2 class="section-title" style="margin-bottom: 16px;">Quick Actions</h2>
    <div class="quick-actions">
        <a href="/gigs" class="btn btn-primary">Browse Gigs</a>
        <a href="/billing" class="btn btn-outline">View Wallet</a>
        {% if user.user_type in ['client', 'both'] %}
        <a href="/post-gig" class="btn btn-outline">Post a Gig</a>
        {% endif %}
        {% if user.is_admin %}
        <a href="/admin" class="btn btn-outline">Admin Dashboard</a>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    function logout() {
        if (confirm('Are you sure you want to logout?')) {
            fetch('/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(() => {
                window.location.href = '/';
            });
        }
    }
</script>
{% endblock %}